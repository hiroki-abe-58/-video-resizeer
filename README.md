# 動画圧縮ツール - 音質優先版

macOS用の動画圧縮CLIツール。目標ファイルサイズを指定して、音質を優先しながら動画を圧縮できるわ。

## 特徴

- **目標サイズを正確に指定**: MB単位で目標サイズを指定可能(小数点可)
- **音質優先**: 音声ビットレート192kbpsで高音質を維持
- **リアルタイム進捗表示**: プログレスバーと残り時間を表示
- **2パスエンコーディング**: 高品質な圧縮を実現
- **拡張子変換対応**: MP4, MOV, AVI, MKV, WebM, FLV
- **わかりやすいエラー表示**: ありがちなミスを全部キャッチ

## 必須要件

- macOS
- Python 3.8以上
- ffmpeg

## インストール

### 1. ffmpegのインストール

```bash
brew install ffmpeg
```

### 2. スクリプトのダウンロード

```bash
# GitHubからクローン(個人用アカウント使用)
git clone https://github.com/hiroki-abe-58/video-compressor.git
cd video-compressor

# または、直接ダウンロード
curl -O https://raw.githubusercontent.com/hiroki-abe-58/video-compressor/main/compress_video.py
chmod +x compress_video.py
```

### 3. 実行権限付与

```bash
chmod +x compress_video.py
```

## 使い方

### 基本的な使い方

```bash
python3 compress_video.py
```

または

```bash
./compress_video.py
```

### 実行フロー

#### フェーズ1: 動画パス入力
```
動画のパスを入力し、エンターを押してください:
> /path/to/video.mp4
```

**Tips**: ファインダーからドラッグ&ドロップでもOK

#### フェーズ2: 目標サイズ入力
```
ファイル名: video.mp4
現在のファイル容量: 150.50 MB
動画の長さ: 00:05:30

この動画を何MBまで圧縮しますか？数字を入力しエンターを押してください。(小数点可):
> 50
```

#### フェーズ3: 拡張子変換(オプション)
```
拡張子は変換しますか？ (y/何も入力せずEnter): y

変換可能な形式:
  1. MP4 (H.264)
  2. MOV (QuickTime)
  3. AVI
  4. MKV (Matroska)
  5. WebM
  6. FLV (Flash Video)

番号を選択してください: 1
```

#### フェーズ4: 圧縮実行
```
[1/2] 1パス目: ビットレート解析中...
1パス目: [████████████████████░░░░░░░░░░░░░░░░░░░░]  48.5% | 残り時間: 00:02:15

[2/2] 2パス目: 最終エンコード中...
2パス目: [████████████████████████████████████████] 100.0% | 残り時間: 00:00:00
```

#### フェーズ5: 完了
```
✅ 圧縮が完了し、圧縮した動画ファイルは保存されました!
============================================================
ファイル名: video--compressed--50.0MB--2025-10-04-15-30-45.mp4
保存先: /path/to/video--compressed--50.0MB--2025-10-04-15-30-45.mp4
目標サイズ: 50.00 MB
実際のサイズ: 49.85 MB
差分: 0.15 MB
============================================================
```

## 📝 出力ファイル名の形式

```
[元ファイル名]--compressed--[目標サイズ]MB--[yyyy-mm-dd-hh-mm-ss].[拡張子]
```

例:
```
my_video--compressed--50.0MB--2025-10-04-15-30-45.mp4
```

## 🛡️ エラーハンドリング

このツールは以下のエラーを検出して、わかりやすく表示するで:

- ❌ ffmpegが未インストール
- ❌ ファイルが存在しない
- ❌ サポートされていないファイル形式
- ❌ 目標サイズが現在のサイズより大きい
- ❌ 目標サイズが小さすぎる(音声だけで容量オーバー)
- ❌ 無効な入力値(数字以外など)
- ❌ エンコード中のエラー

## 🎛️ 技術詳細

### 圧縮アルゴリズム

1. **動画の長さを取得** (ffprobe使用)
2. **音声ビットレートを192kbpsに固定** (高音質維持)
3. **目標サイズから必要なビデオビットレートを逆算**
   ```
   ビデオビットレート = (目標サイズ - 音声サイズ) / 動画の長さ * 0.95
   ```
4. **2パスエンコーディングで高品質圧縮**
   - 1パス目: ビットレート配分を解析
   - 2パス目: 最適化されたエンコーディング

### サポートファイル形式

**入力**: `.mp4`, `.avi`, `.mov`, `.mkv`, `.flv`, `.wmv`, `.webm`, `.m4v`, `.mpeg`, `.mpg`

**出力**: `.mp4`, `.mov`, `.avi`, `.mkv`, `.webm`, `.flv`

## 🔧 トラブルシューティング

### ffmpegが見つからない
```bash
brew install ffmpeg
```

### 圧縮に時間がかかりすぎる
- 2パスエンコーディングは時間がかかる(1パス目+2パス目)
- 長い動画だと数十分かかることもある
- プログレスバーで進捗確認できるで

### 目標サイズとずれる
- ±5%程度の誤差は正常
- より正確にしたい場合は、目標サイズを少し小さめに設定

### エンコードが失敗する
- ディスク容量を確認
- 動画ファイルが壊れていないか確認
- 別の拡張子で試す

## ライセンス

MIT License

## 作者

[hiroki-abe-58](https://github.com/hiroki-abe-58)
